<div class="animated fadeIn">
    <div class="card" id="new">
        <div class="card-header"><i class="icon-pencil"></i> E-LOKET</div>
        <div class="card-block">
            <div class="row">
                <div class="col-md-12">
                    <div class="tab-content">
                        {{!-- form pengajuan user --}}
                        <div class="row col">
                            <h5><strong>- BENDAHARA -</strong></h5>
                        </div>
                        <form id="loketPpk" method="POST" class="modal-body">
                            <div class="row">
                                <div class="col-6">
                                    <input name="tiketId" type="hidden" value="{{data._id}}">
                                    <div class="form-group row">
                                        <label for="loketNamaUnit" class="col-md-2 form-control-label">Unit</label>
                                        <div class="col">
                                            <input type="text" name="loketNamaUnit" id="loketNamaUnit"
                                                class="form-control" value="{{data.unit}}" disabled>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketKodeUnit" class="col-md-2 form-control-label">Kode Unit</label>
                                        <div class="col">
                                            <input type="text" name="loketKodeUnit" id="loketKodeUnit"
                                                class="form-control" value="{{data.kodeUnit}}" disabled>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketOperator" class="col-md-2 form-control-label">Operator</label>
                                        <div class="col">
                                            <input type="text" name="loketOperator" id="loketOperator"
                                                class="form-control" value="{{data.operator}}" disabled>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="" class="col-md-2 form-control-label">Detail Pengajuan</label>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketProgram" class="col ml-1 form-control-label">Program</label>
                                        <div class="col-md-10 input-group">
                                            <select name="loketProgram" id="loketProgram" class="form-select">
                                                <option Selected>Pilih Program</option>
                                            </select>
                                            <input name="loketProgramOk" id="loketProgramOk" class="form-check col-1"
                                                type="checkbox" value="True">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketKegiatan" class="col ml-1 form-control-label">Kegiatan</label>
                                        <div class="col-md-10 input-group">
                                            <select name="loketKegiatan" id="loketKegiatan" class="form-select">
                                                <option selected>Pilih Kegiatan</option>
                                            </select>
                                            <input name="loketKegiatanOk" id="loketKegiatanOk" class="form-check col-1"
                                                type="checkbox" value="True">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketOutput" class="col ml-1 form-control-label">Output</label>
                                        <div class="col-md-10 input-group">
                                            <select name="loketOutput" id="loketOutput" class="form-select">
                                                <option Selected>Pilih Output</option>
                                            </select>
                                            <input name="loketOutputOk" id="loketOutputOk" class="form-check col-1"
                                                type="checkbox" value="True">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketKomponen" class="col ml-1 form-control-label">Komponen</label>
                                        <div class="col-md-10 input-group">
                                            <select name="loketKomponen" id="loketKomponen" class="form-select">
                                                <option Selected>Pilih Komponen</option>
                                            </select>
                                            <input name="loketKomponenOk" id="loketKomponenOk" class="form-check col-1"
                                                type="checkbox" value="True">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketAkun" class="col ml-1 form-control-label">Akun</label>
                                        <div class="col-md-10 input-group">
                                            <select name="loketAkun" id="loketAkun" class="form-select">
                                                <option Selected>Pilih Akun</option>
                                            </select>
                                            <input name="loketAkunOk" id="loketAkunOk" class="form-check col-1"
                                                type="checkbox" value="True">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketTglPelaksanaan" class="col ml-1 form-control-label">Tanggal
                                            Pelaksanaan</label>
                                        <div class="col-md-10">
                                            <input type="date" name="loketTglPelaksanaan" id="loketTglPelaksanaan"
                                                class="form-control" disabled>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketDetail" class="col ml-1 form-control-label">Detail SPJ</label>
                                        <div class="col-md-10">
                                            <input type="text" name="loketDetail" id="loketDetail" class="form-control" value="{{data.detail}}"
                                                disabled>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketNilai" class="col ml-1 form-control-label">Nilai</label>
                                        <label class="ml-2 form-control-label" for="">Rp</label>
                                        <div class="col-md-9">
                                            <input type="text" name="loketNilai" id="loketNilai" class="form-control" value="{{data.nilaiPengajuan}}"
                                                disabled>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="" class="col-md-2 form-control-label">Checklist</label>
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-1" style="text-align:center">Unit</label>
                                        <label for="" class="col-md-1" style="text-align:center">PPK</label>
                                        <label for="" class="col-md-1" style="text-align:center">PPSPM</label>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">SPJ</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistSpjUnit" name="checklistSpjUnit" id="checklistSpjUnit"
                                            disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistSpjPpk" name="checklistSpjPpk" id="checklistSpjPpk"
                                            disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistSpjPpspm" name="checklistSpjPpspm"
                                            id="checklistSpjPpspm" disabled>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">Daftar Hadir</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDaftarHadirUnit" name="checklistDaftarHadirUnit"
                                            id="checklistDaftarHadirUnit" disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDaftarHadirPpk" name="checklistDaftarHadirPpk"
                                            id="checklistDaftarHadirPpk" disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDaftarHadirPpspm" name="checklistDaftarHadirPpspm"
                                            id="checklistDaftarHadirPpspm" disabled>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">Dokumentasi</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDokumentasiUnit" name="checklistDokumentasiUnit"
                                            id="checklistDokumentasiUnit" disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDokumentasiPpk" name="checklistDokumentasiPpk"
                                            id="checklistDokumentasiPpk" disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDokumentasiPpspm" name="checklistDokumentasiPpspm"
                                            id="checklistDokumentasiPpspm" disabled>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">Notulensi</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistNotulensiUnit" name="checklistNotulensiUnit"
                                            id="checklistNotulensiUnit" disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistNotulensiPpk" name="checklistNotulensiPpk"
                                            id="checklistNotulensiPpk" disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistNotulensiPpspm" name="checklistNotulensiPpspm"
                                            id="checklistNotulensiPpspm" disabled>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">CV Narasumber</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistCvUnit" name="checklistCvUnit" id="checklistCvUnit"
                                            disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistCvPpk" name="checklistCvPpk" id="checklistCvPpk"
                                            disabled>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistCvPpspm" name="checklistCvPpspm" id="checklistCvPpspm"
                                            disabled>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketAdkSpj" class="col-md-2 form-control-label">ADK SPJ</label>
                                        <div class="col">
                                            <p id="loketAdkSpj">{{data.filespj}}</p>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketSpp" class="col-md-2 form-control-label">SPP</label>
                                        <div class="col">
                                            <p>{{data.spp}}</p>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketCatatanPpk" class="col-md-2 form-control-label">Catatan
                                            PPK</label>
                                        <div class="col">
                                            <textarea name="loketCatatanPpk" id="loketCatatanPpk" class="form-control"
                                                disabled>{{data.catatan.ppk}}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketCatatanPpspm" class="col-md-2 form-control-label">Catatan
                                            PPSPM</label>
                                        <div class="col">
                                            <textarea name="loketCatatanPpspm" id="loketCatatanPpspm"
                                                class="form-control" disabled>{{data.catatan.ppspm}}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketCatatanReviewer" class="col-md-2 form-control-label">Catatan
                                            Reviewer</label>
                                        <div class="col">
                                            <textarea name="loketCatatanReviewer" id="loketCatatanReviewer"
                                                class="form-control" disabled>{{data.catatan.reviewer}}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketMetodeTransfer" class="col-md-2 form-control-label">Metode
                                            Transfer</label>
                                        <div class="col">
                                            <select name="loketMetodeTransfer" id="loketMetodeTransfer" class="form-select">
                                                <option selected></option>
                                                <option value="cms">CMS</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketNilaiPajak" class="col ml-1 form-control-label">Nilai
                                            Pajak</label>
                                        <label class="ml-2 form-control-label" for="">Rp</label>
                                        <div class="col-md-9">
                                            <input type="text" name="loketNilaiPajak" id="loketNilaiPajak"
                                                class="form-control">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketNilaiTransfer" class="col ml-1 form-control-label">Nilai
                                            Transfer</label>
                                        <label class="ml-2 form-control-label" for="">Rp</label>
                                        <div class="col-md-9">
                                            <input type="text" name="loketNilaiTransfer" id="loketNilaiTransfer"
                                                class="form-control">
                                        </div>
                                    </div>
                                    <div class="modal-footer" id="mainfooter">
                                        <button id="prosesFormBendahara" type="submit" class="btn btn-success"
                                            formaction="loket/bendaharaProses">Proses</button>
                                        <button id="kirimFormBendaharaArsiparis" type="submit" class="btn btn-primary"
                                            formaction="loket/bendaharaKirimArsiparis">Kirim<br><small>(Arsiparis)</small></button>
                                        <button id="kirimFormBendaharaOperatorBmn" type="submit" class="btn btn-primary"
                                            formaction="loket/bendaharaKirimBmn">Kirim<br><small>(Operator
                                                BMN)</small></button>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="loketInputRealisasi" class="btn btn-primary" type="submit"
                                            formaction="loket/bendaharaInputRealisasi">Input Realisasi</button>
                                        <button id="loektInputPajak" class="btn btn-primary" type="submit"
                                            formaction="loket/bendaharaInputPajak">Input Pajak</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/handsontable.full.min.js"></script>
<script src="/js/moment.min.js"></script>
<script src="/js/locale/id.js"></script>
<script src="/js/bootstrap-datetimepicker.js"></script>
<script src="/js/highcharts.js"></script>
<script src="/js/data.js"></script>
<script src="/js/drilldown.js"></script>
<script src="/js/exporting.js"></script>
<script src="/js/offline-exporting.js"></script>

{{!-- autofill form --}}
<script id="tglPelaksanaan" type="text/x-handlebars-template">
    {{data.tanggal.pelaksanaan}}
</script>

{{!-- iterasi select pok --}}
<script id="program" type="text/x-handlebars-template">
    {{#if data.kdprogram}}
        <option value="{{data.kdprogram}}" selected>{{data.kdprogram}} {{data.uraianProgram}}</option>
        {{#each program}}
            <option value="{{this.kdprogram}}">{{this.kdprogram}} {{this.uraian}}</option>
        {{/each}}
    {{else}}
        {{#each program}}
            <option value="{{this.kdprogram}}">{{this.kdprogram}} {{this.uraian}}</option>
        {{/each}}
    {{/if}}
</script>
<script id="kegiatan" type="text/x-handlebars-template">
    {{#if data.kdkegiatan}}
        <option value="{{data.kdkegiatan}}" selected>{{data.kdkegiatan}} {{data.uraianKegiatan}}</option>
        {{#each kegiatan}}
            <option value="{{this.kdgiat}}">{{this.kdgiat}} {{this.uraian}}</option>
        {{/each}}
    {{else}}
        {{#each kegiatan}}
            <option value="{{this.kdgiat}}">{{this.kdgiat}} {{this.uraian}}</option>
        {{/each}}
    {{/if}}
</script>
<script id="output" type="text/x-handlebars-template">
    {{#if data.kdoutput}}
        <option value="{{data.kdoutput}}" selected>{{data.kdoutput}} {{data.uraianOutput}}</option>
        {{#each output}}
            <option value="{{this.kdoutput}}">{{this.kdoutput}} {{this.uraian}}</option>
        {{/each}}
    {{else}}
        {{#each output}}
            <option value="{{this.kdoutput}}">{{this.kdoutput}} {{this.uraian}}</option>
        {{/each}}
    {{/if}}
</script>
<script id="komponen" type="text/x-handlebars-template">
    {{#if data.kdkomponen}}
        <option value="{{data.kdkomponen}}" selected>{{data.kdkomponen}} {{data.uraianKomponen}}</option>
        {{#each komponen}}
            <option value="{{this.kdkmpnen}}">{{this.kdkmpnen}} {{this.urkmpnen}}</option>
        {{/each}}
    {{else}}
        {{#each komponen}}
            <option value="{{this.kdkmpnen}}">{{this.kdkmpnen}} {{this.urkmpnen}}</option>
        {{/each}}
    {{/if}}
</script>
<script id="akun" type="text/x-handlebars-template">
    {{#if data.kdakun}}
        <option value="{{data.kdakun}}" selected>{{data.kdakun}} {{data.uraianAkun}}</option>
        {{#each akun}}
            <option value="{{this.kdakun}}">{{this.kdakun}} {{this.uraian}}</option>
        {{/each}}
    {{else}}
        {{#each akun}}
            <option value="{{this.kdakun}}">{{this.kdakun}} {{this.uraian}}</option>
        {{/each}}
    {{/if}}
</script>

{{!-- main script --}}
<script type="text/javascript">
    //socket = io.connect($(location).attr('host'));
    var socket = io()

    //untuk hak akses
    //var user_aktiv = '{{username}}';

    $(document).ready(function () {
        //autofill form
        var t1 = $("#tglPelaksanaan").html()
        var t2 = new Date(t1)
        $("#loketTglPelaksanaan").val(t2.getFullYear()+'-'+t2.getMonth()+1+'-'+t2.getDate())
        var spj = [{{data.checklist.spj}}]
        var hadir = [{{data.checklist.daftarHadir}}]
        var dok = [{{data.checklist.dokumentasi}}]
        var not = [{{data.checklist.notulensi}}]
        var cv = [{{data.checklist.cvNarasumber}}]
        
        if (spj[0]) $("#checklistSpjUnit").attr("checked", true)
        if (hadir[0]) $("#checklistDaftarHadirUnit").attr("checked", true)
        if (dok[0]) $("#checklistDokumentasiUnit").attr("checked", true)
        if (not[0]) $("#checklistNotulensiUnit").attr("checked", true)
        if (cv[0]) $("#checklistCvUnit").attr("checked", true)
        if (spj[1]) $("#checklistSpjPpk").attr("checked", true)
        if (hadir[1]) $("#checklistDaftarHadirPpk").attr("checked", true)
        if (dok[1]) $("#checklistDokumentasiPpk").attr("checked", true)
        if (not[1]) $("#checklistNotulensiPpk").attr("checked", true)
        if (cv[1]) $("#checklistCvPpk").attr("checked", true)
        if (spj[2]) $("#checklistSpjPpspm").attr("checked", true)
        if (hadir[2]) $("#checklistDaftarHadirPpspm").attr("checked", true)
        if (dok[2]) $("#checklistDokumentasiPpspm").attr("checked", true)
        if (not[2]) $("#checklistNotulensiPpspm").attr("checked", true)
        if (cv[2]) $("#checklistCvPpspm").attr("checked", true)

        //iterasi select pok on autofill
        var pokProgram = $("#program").html()
        $("#loketProgram").append(pokProgram)
        var pokKegiatan = $("#kegiatan").html()
        $("#loketKegiatan").append(pokKegiatan)
        var pokOutput = $("#output").html()
        $("#loketOutput").append(pokOutput)
        var pokKomponen = $("#komponen").html()
        $("#loketKomponen").append(pokKomponen)
        var pokAkun = $("#akun").html()
        $("#loketAkun").append(pokAkun)

        //iterasi select pok
        $("#loketProgram").change(function(){
            if ($("#loketProgram").val()!="Pilih Program"){
                console.log($("#loketProgram").val())
                socket.emit('mintaKegiatan', $("#loketProgram").val())
            } else {
                $("#loketKegiatan").empty().append('<option selected>Pilih Kegiatan</option>')
                $("#loketOutput").empty().append('<option selected>Pilih Output</option>')
                $("#loketKomponen").empty().append('<option selected>Pilih Komponen</option>')
                $("#loketAkun").empty().append('<option selected>Pilih Akun</option>')
            }
        })

        socket.on('terimaKegiatan', function(kegiatan){
            let sama = false
            $("#loketKegiatan").empty().append('<option selected>Pilih Kegiatan</option>')
            for (let i=0; i<kegiatan.length;i++){
                $('#loketKegiatan option').each( function() {if (kegiatan[i].kdgiat == this.value) sama = true})
                if (!sama) {
                    let s = '<option value="'+kegiatan[i].kdgiat+'">'+kegiatan[i].kdgiat+' '+kegiatan[i].uraian+'</option>'
                    $("#loketKegiatan").append(s)
                }
                sama = false
            }
        })

        $("#loketKegiatan").change(function(){
            if ($("#loketKegiatan").val()!="Pilih Kegiatan"){
                console.log($("#loketKegiatan").val())
                let s = [$("#loketProgram").val(), $("#loketKegiatan").val()]
                socket.emit('mintaOutput', s)
            } else {
                $("#loketOutput").empty().append('<option selected>Pilih Output</option>')
                $("#loketKomponen").empty().append('<option selected>Pilih Komponen</option>')
                $("#loketAkun").empty().append('<option selected>Pilih Akun</option>')
            }
        })

        socket.on('terimaOutput', function(output){
            let sama = false
            $("#loketOutput").empty().append('<option selected>Pilih Output</option>')
            for (let i=0; i<output.length;i++){
                $('#loketOutput option').each( function() {if (output[i].kdoutput == this.value) sama = true})
                if (!sama) {
                    let s = '<option value="'+output[i].kdoutput+'">'+output[i].kdoutput+' '+output[i].uraian+'</option>'
                    $("#loketOutput").append(s)
                }
                sama = false
            }
        })

        $("#loketOutput").change(function(){
            if ($("#loketOutput").val()!="Pilih Output"){
                console.log($("#loketOutput").val())
                let s = [$("#loketProgram").val(), $("#loketKegiatan").val(), $("#loketOutput").val()]
                socket.emit('mintaKomponen', s)
            } else {
                $("#loketKomponen").empty().append('<option selected>Pilih Komponen</option>')
                $("#loketAkun").empty().append('<option selected>Pilih Akun</option>')
            }
        })

        socket.on('terimaKomponen', function(komponen){
            let sama = false
            $("#loketKomponen").empty().append('<option selected>Pilih Komponen</option>')
            for (let i=0; i<komponen.length;i++){
                $('#loketKomponen option').each( function() {if (komponen[i].kdkmpnen == this.value) sama = true})
                if (!sama) {
                    let s = '<option value="'+komponen[i].kdkmpnen+'">'+komponen[i].kdkmpnen+' '+komponen[i].urkmpnen+'</option>'
                    $("#loketKomponen").append(s)
                }
                sama = false
            }
        })

        $("#loketKomponen").change(function(){
            if ($("#loketKomponen").val()!="Pilih Komponen"){
                console.log($("#loketKomponen").val())
                let s = [$("#loketProgram").val(), $("#loketKegiatan").val(), $("#loketOutput").val(), $("#loketKomponen").val()]
                socket.emit('mintaAkun', s)
            } else {$("#loketAkun").empty().append('<option selected>Pilih Akun</option>')}
        })

        socket.on('terimaAkun', function(akun){
            let sama = false
            $("#loketAkun").empty().append('<option selected>Pilih Akun</option>')
            for (let i=0; i<akun.length;i++){
                $('#loketAkun option').each( function() {if (akun[i].kdakun == this.value) sama = true})
                if (!sama) {
                    let s = '<option value="'+akun[i].kdakun+'">'+akun[i].kdakun+' '+akun[i].uraian+'</option>'
                    $("#loketAkun").append(s)
                }
                sama = false
            }
        })
        
        //alert permintaan diproses
        $('#prosesFormBendahara').click(function () {
            alert("Tiket telah diteruskan ke Operator Bank")
        })
        $('#kirimFormBendaharaArsiparis').click(function () {
            alert("Tiket telah diteruskan ke Arsiparis")
        })
        $('#kirimFormBendaharaOperatorBmn').click(function () {
            alert("Tiket telah diteruskan ke Operator BMN")
        })    

    });

</script>