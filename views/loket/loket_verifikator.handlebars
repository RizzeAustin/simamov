<div class="animated fadeIn">
    <div class="card" id="new">
        <div class="card-header"><i class="icon-pencil"></i> E-LOKET</div>
        <div class="card-block">
            <div class="row">
                <div class="col-md-12">
                    <div class="tab-content">
                        {{!-- form pengajuan user --}}
                        <div class="row col">
                            <h1><strong>- VERIFIKATOR -</strong></h1>
                        </div>
                        <form id="loketForm" method="POST" action="loket/verifikasi" class="modal-body">
                            <div class="row">
                                <div class="col-6">
                                    <input name="tiketId" type="hidden" value="{{data._id}}">
                                    <div class="form-group row">
                                        <label for="loketNamaUnit" class="col-md-2 col-form-label">Unit</label>
                                        <div class="col">
                                            <select name="loketNamaUnit" id="loketNamaUnit" class="form-control" required>
                                                <option value="{{data.unit}}">{{data.unit}}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketKodeUnit" class="col-md-2 col-form-label">Kode Unit</label>
                                        <div class="col">
                                            <input type="text" name="loketKodeUnit" id="loketKodeUnit" class="form-control" required value="{{data.kodeUnit}}">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketOperator" class="col-md-2 col-form-label">Operator</label>
                                        <div class="col">
                                            <input type="text" name="loketOperator" id="loketOperator" placeholder="Nama Petugas" class="form-control" required value="{{data.operator}}">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="" class="col-md-2 col-form-label">Detail Pengajuan</label>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketProgram" class="col ml-1 col-form-label">Program</label>
                                        <div class="col-md-10">
                                            <select name="loketProgram" id="loketProgram" class="form-select" disabled>
                                                <option>Pilih Program</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketKegiatan" class="col ml-1 col-form-label">Aktivitas</label>
                                        <div class="col-md-10">
                                            <select name="loketKegiatan" id="loketKegiatan" class="form-select" disabled>
                                                <option>Pilih Aktivitas</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketOutput" class="col ml-1 col-form-label">KRO</label>
                                        <div class="col-md-10">
                                            <select name="loketOutput" id="loketOutput" class="form-select" disabled>
                                                <option>Pilih KRO</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketKomponen" class="col ml-1 col-form-label">Komponen</label>
                                        <div class="col-md-10">
                                            <select name="loketKomponen" id="loketKomponen" class="form-select" disabled>
                                                <option>Pilih Komponen</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketAkun" class="col ml-1 col-form-label">Akun</label>
                                        <div class="col-md-10">
                                            <select name="loketAkun" id="loketAkun" class="form-select" disabled>
                                                <option>Pilih Akun</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketDetailPok" class="col ml-1 col-form-label">Detail POK</label>
                                        <div class="col-md-10">
                                            <select name="loketDetailPok" id="loketDetailPok" class="form-select" disabled>
                                                <option>Pilih Detail</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group row">
                                        <label for="loketTglPelaksanaan" class="col ml-1 col-form-label">Tanggal Pelaksanaan</label>
                                        <div class="col-md-10">
                                            <input type="date" name="loketTglPelaksanaan" id="loketTglPelaksanaan" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketDetail" class="col ml-1 col-form-label">Detail SPJ</label>
                                        <div class="col-md-10">
                                            <input type="text" name="loketDetail" id="loketDetail" class="form-control" placeholder="Nama SPJ" required value="{{data.detail}}">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketNilai" class="col ml-1 col-form-label">Nilai Bruto</label>
                                        <label class="ml-2 col-form-label" for="">Rp</label>
                                        <div class="col-md-9">
                                            <input type="text" name="loketNilai" id="loketNilai" class="form-control" placeholder="Contoh: 1000000" required value="{{data.nilaiPengajuan}}">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="" class="col-md-2 col-form-label">Checklist</label>
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-1 col-form-label" style="text-align:center">Unit</label>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">SPJ</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistSpjUnit" name="checklistSpjUnit" id="checklistSpjUnit">
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">Daftar Hadir</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDaftarHadirUnit" name="checklistDaftarHadirUnit"
                                            id="checklistDaftarHadirUnit">
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">Dokumentasi</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistDokumentasiUnit" name="checklistDokumentasiUnit"
                                            id="checklistDokumentasiUnit">
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">Notulensi</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistNotulensiUnit" name="checklistNotulensiUnit"
                                            id="checklistNotulensiUnit">
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-md-2"></div>
                                        <label for="" class="col-md-2 form-control-label">CV Narasumber</label>
                                        <input class="col-md-1 form-check" type="checkbox" value="True"
                                            aria-label="checklistCvUnit" name="checklistCvUnit" id="checklistCvUnit">
                                    </div>
                                    <div class="form-group row">
                                        <label for="loketAdkSpj" class="col-md-2 col-form-label">ADK SPJ</label>
                                        <div class="col">
                                            <p id="loketAdkSpj">{{data.fileSpj}}</p>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="kirimFormUnit" type="submit" class="btn btn-success">Verifikasi</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var socket = io.connect($(location).attr('host'));
    //var socket = io()

    //untuk hak akses
    //var user_aktiv = '{{username}}';

    $(document).ready(function () {

        //autofill form
        //var t1 = new Date($("{{data.tanggal.pelaksanaan}}").html())
        var t1 = new Date("{{data.tanggal.pelaksanaan}}")
        //console.log(t1)
        var t2 = vtgl(t1)
        $('#loketTglPelaksanaan').val(t2)

        //autofill checklist
        var spj = [{{data.checklist.spj}}]
        var hadir = [{{data.checklist.daftarHadir}}]
        var dok = [{{data.checklist.dokumentasi}}]
        var not = [{{data.checklist.notulensi}}]
        var cv = [{{data.checklist.cvNarasumber}}]
        
        if (spj[0]) $('#checklistSpjUnit').attr("checked", true)
        if (hadir[0]) $('#checklistDaftarHadirUnit').attr("checked", true)
        if (dok[0]) $('#checklistDokumentasiUnit').attr("checked", true)
        if (not[0]) $('#checklistNotulensiUnit').attr("checked", true)
        if (cv[0]) $('#checklistCvUnit').attr("checked", true)

        $('#loketNamaUnit').focus()
        
        $('form').submit( function(e) {
            e.preventDefault()
            var form = this
            generalAlert('Tiket akan diteruskan ke PPK dan Redirect ke dashboard dalam 5 detik')
            setTimeout( function () { 
                form.submit()
            }, 5000)
        });

    });

    function vtgl(tgl){
        let y = tgl.getFullYear()
        let m = tgl.getMonth() + 1
        let d = tgl.getDate()
        if (m<10) m = '0'+m
        if (d<10) d = '0'+d
        return `${y}-${m}-${d}`
    }

    function generalAlert(message){
        $.toast({
            text: message,
            textAlign: 'left', 
            hideAfter: 5000,
            loader: false,
            position: 'bottom-right',
            stack: 2
        })
    }

</script>